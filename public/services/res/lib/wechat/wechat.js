/*! CopyRight: sofish http://github.com/sofish/wechat.js, Licensed under: MIT */

(function(e,t){var n=function(){},r=function(){this.calls=[],this.map={events:{friend:"menu:share:appmessage",timeline:"menu:share:timeline",weibo:"menu:share:weibo",email:"email"},actions:{friend:"sendAppMessage",timeline:"shareTimeline",weibo:"shareWeibo",email:"email"},direct:{network:"getNetworkType",hideToolbar:"hideToolbar",hideOptionMenu:"hideOptionMenu",showOptionMenu:"showOptionMenu",closeWebView:"closeWindow",scanQRCode:"scanQRCode",imagePreview:"imagePreview"}}};r.prototype._data=function(e,t){if(!e)return{};var n={};for(var r in e){if(!e.hasOwnProperty(r))return;n[r]=typeof e[r]=="function"?e[r]():e[r]}return n.appid=n.app,n.img_url=n.img,delete n.app,delete n.img,t==="weibo"?(n.content=n.desc,n.url=n.link):t==="timeline"?(n.title=n.title+" - "+n.desc,n.desc=n.title):t==="email"&&(n.content=n.desc+" "+n.link),n},r.prototype._make=function(e){if(typeof WeixinJSBridge=="undefined")return this.calls.push(e);var t=e.name,n=this.map.direct[t],r=e.data,i=e.callback;if(n)return t==="network"?WeixinJSBridge.invoke(n,{},i):t==="imagePreview"?WeixinJSBridge.invoke(n,r,i):WeixinJSBridge.call(n,i);if(t==="email")return WeixinJSBridge.invoke("sendEmail",this._data(r,t),i);var s=this;WeixinJSBridge.on(this.map.events[t],function(){WeixinJSBridge.invoke(s.map.actions[t],s._data(r,t),i)})},r.prototype.on=function(e,t,r){if(!e)return;return typeof t=="function"&&(r=t,t=null),this._make({name:e,data:t,callback:r||n}),this};var i=function(){for(var e=0,t=s.calls.length;e<t;e++)s._make(s.calls[e])},s=new r,o=function(){return s.on.apply(s,arguments)};typeof exports!="undefined"&&module.exports?module.exports=exports=o:typeof define=="function"?define(["require","exports","module"],function(e,t,n){n.exports=t=o}):e.wechat=e.wechat||o,typeof WeixinJSBridge=="undefined"?t.addEventListener?t.addEventListener("WeixinJSBridgeReady",i,!1):(t.attachEvent("WeixinJSBridgeReady",i),t.attachEvent("onWeixinJSBridgeReady",i)):i()})(window,document);