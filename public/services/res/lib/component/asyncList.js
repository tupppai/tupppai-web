define(["zepto","common","lib/imagesloaded/imagesloaded","lib/masonry/masonry","lib/infinite/jquery-ias"],function(e,t,n,r,i){"use strict";var s=function(t,i){var s=t,o=0,u=s.$(".loading");_.each(u,function(t){o++,e(t).removeClass("loading").hide(),n(t,function(n){o--,o==0&&(s.loading=!1);if(n.hasAnyBroken)return!1;s.time=s.threshold-(new Date).getTime()+s.beginTime,setTimeout(function(){e(t).addClass("grid-item").show(),s.msnry&&s.msnry.appended(t),s.msnry&&s.msnry.layout(),e("#__loading").remove()},s.time)})}),s.msnry||(s.msnry=new r(".grid",{itemSelector:".grid-item",columnWidth:0}))};e.fn.asynclist=function(t){this.$el=this;var n=t;n.time=0,n.page=1,n.size=15,n.threshold=2e3,n.loading=!1,s(n),e(window).scroll(function(){var t=e(document).height()-e(window).height(),r=document.documentElement.scrollTop+document.body.scrollTop;if(r==t&&!n.loading){n.$el.append(loadingDiv),n.beginTime=(new Date).getTime(),n.loading=!0,n.page++;var i=new window.app.collection;i.url=n.collection.url,i.fetch({data:{page:n.page,size:n.size},success:function(e){var t=e.models;_.each(t,function(e){n.collection.add(e),s(n)})}})}})}});