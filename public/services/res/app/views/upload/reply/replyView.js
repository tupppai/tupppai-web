define(["tpl!app/views/upload/reply/reply.html","wx"],function(e){"use strict";return window.app.view.extend({tagName:"div",className:"",template:e,onShow:function(){$(".menuPs").addClass("hide"),title("发布作品");var e={};share_friend(e,function(){},function(){}),share_friend_circle(e,function(){},function(){})},events:{"click #uploadWork":"fnUploadImage","click .uploadCancel":"emptyPic","click #fnSubmitDynamic":"fnSubmitDynamic","keydown .uploadDesc":"uploadDesc"},emptyPic:function(e){$("#fileList").text(""),$(".holderBorder").show(),$(".holderMain").show(),$(".uploadCancel").addClass("hide")},uploadDesc:function(e){var t=$("body").attr("upload_id"),n=$(".uploadDesc").val();n.length>=10&&t&&$(".confirm-none").addClass("confirm")},fnSubmitDynamic:function(){var e=$("body").attr("data-uid"),t=$("body").attr("ask_id"),n=$("#append_image"),r=n[0].childElementCount,i=[],s=$("body").attr("upload_id"),o=$(".uploadDesc").val();for(var u=0;r>u;)i[u]=n[0].childNodes[u].children[0].currentSrc,u++;var a={ask_id:t,desc:o,upload_id:s};if(o=="")return fntoast("内容不能为空","hide"),!1;if(!i)return fntoast("图片不能为空","hide"),!1;$.post("/replies/save",a,function(e){fntoast("发布成功","hide"),setTimeout(function(){},1500),location.href="#ask/detail/"+t})},fnUploadImage:function(){wx.chooseImage({count:1,success:function(e){var t=e.localIds,n=t.toString(),r='<div class="clips-wrapper"><img src="'+n+'" class="clips"></div>',i=$(".uploadDesc").val();$("#append_image").append(r);var s=Number($("#image_count").text());s++,$("#image_count").text(s),s==1&&($(".uploadText").addClass("hide"),$("#uploadWork").addClass("hide")),wx.uploadImage({localId:n,isShowProgressTips:1,success:function(e){var t=e.serverId,n={media_id:t};$.post("/v2/upload",n,function(e){$("body").attr("upload_id",e.upload_id),i.length>=10&&$(".confirm-none").addClass("confirm")})}})}})}})});