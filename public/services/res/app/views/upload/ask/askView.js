define(["tpl!app/views/upload/ask/ask.html"],function(e){"use strict";return window.app.view.extend({tagName:"div",className:"",template:e,onShow:function(){title("发布求P"),$(".menuPs").addClass("hide");var e={};share_friend(e,function(){},function(){}),share_friend_circle(e,function(){},function(){})},events:{"click .uploadCancel":"emptyPic","click .confirm":"fnSubmitDynamic","click #uploadWork":"fnUploadImage","keydown .uploadDesc":"uploadDesc"},emptyPic:function(e){$("#fileList").text(""),$(".holderBorder").show(),$(".holderMain").show(),$(".uploadCancel").addClass("hide")},uploadDesc:function(e){var t=$("body").attr("upload_id"),n=$(".uploadDesc").val();n.length>=10&&t&&$(".confirm-none").addClass("confirm")},fnSubmitDynamic:function(){var e=$("#append_image"),t=e[0].childElementCount,n=[],r=$("body").attr("upload_id"),i=$(".uploadDesc").val();for(var s=0;t>s;)n[s]=e[0].childNodes[s].children[0].currentSrc,s++;var o={desc:i,upload_id:r};if(i=="")return fntoast("内容不能为空","hide"),!1;if(!n)return fntoast("图片不能为空","hide"),!1;$.post("/asks/save",o,function(e){fntoast("发布成功","hide"),setTimeout(function(){},1500),location.href="#ask/index"})},fnUploadImage:function(){wx.chooseImage({count:1,success:function(e){var t=e.localIds,n=t.toString(),r=$(".uploadDesc").val(),i='<div class="clips-wrapper"><img src="'+n+'" class="clips"></div>';$("#append_image").append(i);var s=Number($("#image_count").text());s++,$("#image_count").text(s),s==1&&($(".uploadText").addClass("hide"),$("#uploadWork").addClass("hide")),wx.uploadImage({localId:n,isShowProgressTips:1,success:function(e){var t=e.serverId,n={media_id:t};$.post("/v2/upload",n,function(e){$("body").attr("upload_id",e.upload_id),r.length>=10&&$(".confirm-none").addClass("confirm")})}})}})}})});