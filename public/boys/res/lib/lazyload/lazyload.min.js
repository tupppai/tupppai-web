/*!
 * An jQuery | zepto plugin for lazy loading images.
 * author -> jieyou
 * see https://github.com/jieyou/lazyload
 * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)
 * use component's throttle https://github.com/component/throttle (MIT)
 */

!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)}(function(e,t){function n(){}function r(e,t){var n;return n=t._$container==h?("innerHeight"in c?c.innerHeight:h.height())+h.scrollTop():t._$container.offset().top+t._$container.height(),n<=e.offset().top-t.threshold}function i(t,n){var r;return r=n._$container==h?h.width()+(e.fn.scrollLeft?h.scrollLeft():c.pageXOffset):n._$container.offset().left+n._$container.width(),r<=t.offset().left-n.threshold}function s(e,t){var n;return n=t._$container==h?h.scrollTop():t._$container.offset().top,n>=e.offset().top+t.threshold+e.height()}function o(t,n){var r;return r=n._$container==h?e.fn.scrollLeft?h.scrollLeft():c.pageXOffset:n._$container.offset().left,r>=t.offset().left+n.threshold+t.width()}function u(e,t){var n=0;e.each(function(u,a){function f(){l.trigger("_lazyload_appear"),n=0}var l=e.eq(u);if(!(l.width()<=0&&l.height()<=0||"none"===l.css("display")))if(t.vertical_only){if(!s(l,t))if(r(l,t)){if(++n>t.failure_limit)return!1}else f()}else if(!s(l,t)&&!o(l,t))if(r(l,t)||i(l,t)){if(++n>t.failure_limit)return!1}else f()})}function a(e){return e.filter(function(t,n){return!e.eq(t)._lazyload_loadStarted})}function f(e,t){function n(){o=0,u=+(new Date),s=e.apply(r,i),r=null,i=null}var r,i,s,o,u=0;return function(){r=this,i=arguments;var e=new Date-u;return o||(e>=t?n():o=setTimeout(n,t-e)),s}}var l,c=window,h=e(c),p={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:c,data_attribute:"original",data_srcset_attribute:"original-srcset",skip_invisible:!0,appear:n,load:n,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:n,no_fake_img_loader:!1,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"};l=function(){var e=Object.prototype.toString;return function(t){return e.call(t).replace("[object ","").replace("]","")}}(),e.fn.hasOwnProperty("lazyload")||(e.fn.lazyload=function(t){var r,i,s,o=this;return e.isPlainObject(t)||(t={}),e.each(p,function(n,r){-1!=e.inArray(n,["threshold","failure_limit","check_appear_throttle_time"])?"String"==l(t[n])?t[n]=parseInt(t[n],10):t[n]=r:"container"==n?(t.hasOwnProperty(n)?t[n]==c||t[n]==document?t._$container=h:t._$container=e(t[n]):t._$container=h,delete t.container):!p.hasOwnProperty(n)||t.hasOwnProperty(n)&&l(t[n])==l(p[n])||(t[n]=r)}),r="scroll"==t.event,s=0==t.check_appear_throttle_time?u:f(u,t.check_appear_throttle_time),i=r||"scrollstart"==t.event||"scrollstop"==t.event,o.each(function(r,s){var u=this,f=o.eq(r),l=f.attr("src"),c=f.attr("data-"+t.data_attribute),h=t.url_rewriter_fn==n?c:t.url_rewriter_fn.call(u,f,c),p=f.attr("data-"+t.data_srcset_attribute),d=f.is("img");return 1==f._lazyload_loadStarted||l==h?(f._lazyload_loadStarted=!0,void (o=a(o))):(f._lazyload_loadStarted=!1,d&&!l&&f.one("error",function(){f.attr("src",t.placeholder_real_img)}).attr("src",t.placeholder_data_img),f.one("_lazyload_appear",function(){function r(){i&&f.hide(),d?(p&&f.attr("srcset",p),h&&f.attr("src",h)):f.css("background-image",'url("'+h+'")'),i&&f[t.effect].apply(f,s?t.effect_params:[]),o=a(o)}var i,s=e.isArray(t.effect_params);f._lazyload_loadStarted||(i="show"!=t.effect&&e.fn[t.effect]&&(!t.effect_params||s&&0==t.effect_params.length),t.appear!=n&&t.appear.call(u,f,o.length,t),f._lazyload_loadStarted=!0,t.no_fake_img_loader||p?(t.load!=n&&f.one("load",function(){t.load.call(u,f,o.length,t)}),r()):e("<img />").one("load",function(){r(),t.load!=n&&t.load.call(u,f,o.length,t)}).attr("src",h))}),void (i||f.on(t.event,function(){f._lazyload_loadStarted||f.trigger("_lazyload_appear")})))}),i&&t._$container.on(t.event,function(){s(o,t)}),h.on("resize load",function(){s(o,t)}),e(function(){s(o,t)}),this})});