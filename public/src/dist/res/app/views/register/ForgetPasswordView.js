define(["app/views/Base","app/models/User","tpl!app/templates/register/ForgetPasswordView.html"],function(e,t,n){"use strict";return e.extend({tagName:"div",className:"",template:n,construct:function(){var e=this;$(".forget-popup").fancybox({afterShow:function(){$("#sned_code").click(e.countdown),$("#confirm_login").unbind("click").bind("click",e.changePassword),$(".fg-main input").keyup(e.keyup)}})},keyup:function(){var e=$("input[name=forgetPwd_phone]").val(),t=$("input[name=forgetPwd_code]").val(),n=$("input[name=forgetPwd_newPassword]").val(),r=$("input[name=forgetPwd_anewPassword]").val();e!=""&&t!=""&&n!=""&&r!=""&&(console.log(123),$(".confirm-and-login").removeAttr("disabled").addClass("bg-btn")),(e==""||t==""||n==""||r=="")&&$(".confirm-and-login").attr("disabled",!0).removeClass("bg-btn")},countdown:function(){var e={wait:60,hsTime:function(e){var t=$(this),n=$(e).val();n=n.slice(0,-1),t.addClass("sent");if(n==0)$("#sned_code").removeAttr("disabled").removeClass("sent").val("重新发送"),t.wait=60;else{var t=this;$(e).attr("disabled",!0).addClass("sent").val(+t.wait+"S"),t.wait--,setTimeout(function(){t.hsTime(e)},1e3)}}},t=$("input[name=forgetPwd_phone]").val(),n="/user/code?phone="+t;$.get(n,function(e){console.log(e)}),e.hsTime("#sned_code")},changePassword:function(){var e=$("input[name=forgetPwd_phone]").val(),t=$("input[name=forgetPwd_code]").val(),n=$("input[name=forgetPwd_newPassword]").val(),r=$("input[name=forgetPwd_anewPassword]").val();if(e=="")return alert("手机号不能为空"),!1;if(t=="")return alert("验证码不能为空"),!1;if(n==""||r=="")return alert("密码不能为空"),!1;if(n!=r)return alert("两个密码不相同"),!1;var i="/user/forget",s={phone:e,code:t,new_pwd:n};$.post(i,s,function(e){e.ret==1?(history.go(1),location.reload()):console.log(e)})}})});