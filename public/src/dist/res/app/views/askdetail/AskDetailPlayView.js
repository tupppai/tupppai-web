define(["app/views/Base","app/models/Base","app/models/Ask","app/models/Reply","app/collections/Comments","tpl!app/templates/askdetail/AskDetailPlayView.html","app/views/askdetail/AskDetailPersonView","app/views/askdetail/AskDetailCommentView","app/views/askdetail/AskDetailCountView","app/views/askdetail/AskDetailActionView"],function(e,t,n,r,i,s,o,u,a,f){"use strict";return e.extend({tagName:"div",className:"",template:s,events:{"click .like_toggle":"likeToggleLarge","click .pic-scroll":"picScroll","click #askDetailRight":"picScroll","click #askDetailLeft":"picScroll","click .reply-play":"replyBlo","click .reply-more":"moreScroll","click #replyCommentBtn":"replyCommentBtn","click .inp-reply":"inpReply","click .reply-cancel":"replyNone","click .download":"download"},inpReply:function(e){var t=$(e.currentTarget).siblings(".play-inp"),n=t.val(),r=t.attr("reply-to"),i=t.attr("data-type"),s=t.attr("comment-id"),o=t.attr("target-id"),u="/comments/save",a={content:n,type:i,id:o,reply_to:r,for_comment:s};$.post(u,a,function(e){var t=e.info;e.ret==1&&(toast("回复评论成功"),$(".center-loading-image-container[data-id="+o+"]").trigger("click"))})},replyCommentBtn:function(e){var t=$(e.currentTarget).attr("data-id"),n=$(e.currentTarget).attr("data-type"),r=$("#textInp").val();if(!r||r=="")return toast("内容不能为空"),!1;$.post("/comments/save",{id:t,type:n,content:r},function(e){if(e.ret==1){$(".center-loading-image-container[data-id="+t+"]").trigger("click"),$("#textInp").val(" ");var n=$(document)}else $(".login-popup").click()})},moreScroll:function(){$(".reply-detail-ifo").scrollTop(204),$(".reply-more").addClass("blo"),$(".reply-detail-ifo").css({overflow:"auto"})},sendComment:function(e){var t=$(e.currentTarget).attr("data-id"),n=$(e.currentTarget).attr("data-type"),r=$(e.currentTarget).prev().val();if(!r||r=="")return toast("内容不能为空"),!1;$.post("/comments/save",{id:t,type:n,content:r},function(e){if(e.ret==1){$(".reply-trigger[data-id="+t+"]").trigger("click"),$(".praise-comment textarea").val(" ");var n=$(document);n.scrollTop(n.height())}else $(".login-popup").click()})},replyNone:function(e){$(".inp-frame").addClass("blo")},replyBlo:function(e){$(e.currentTarget).parents(".reply-ifo").siblings(".inp-frame").removeClass("blo").parents(".user-ifo").siblings(".user-ifo").find(".inp-frame").addClass("blo")},picScroll:function(e){var t=$(".pic-scroll img"),s=t.length,l=parseInt($(".detail-pic").attr("otherNum")),c=null,h=null;e.currentTarget.id=="replyDetailRight"&&(l++,l>=s-1&&(l=s-1),$(".detail-pic").attr("otherNum",l)),e.currentTarget.id=="replyDetailLeft"&&(l--,l<=0&&(l=0),$(".detail-pic").attr("otherNum",l)),$(e.currentTarget).hasClass("center-loading-image-container")&&(l=$(e.currentTarget).index(),$(".detail-pic").attr("otherNum",l)),c=t.eq(l).attr("src"),$("#bigPic").attr("src",c),t.eq(l).parents(".center-loading-image-container").addClass("change-pic").siblings(".center-loading-image-container").removeClass("change-pic"),$(".original-pic").removeClass("original-change"),l==s-1?$("#replyDetailRight").css({display:"none"}):$("#replyDetailRight").css({display:"block"}),l==0?$("#replyDetailLeft").css({display:"none"}):$("#replyDetailLeft").css({display:"block"});var p=l+1;parseInt($(".detail-pic").css("marginLeft"))==0&&(h=3),p>h&&p<s&&p>=3&&($(".detail-pic").animate({marginLeft:-90*(p-3)+"px"},400),h=p);var d=t.eq(l).parents(".center-loading-image-container").attr("data-id"),v=t.eq(l).parents(".center-loading-image-container").attr("data-type");$("#replyCommentBtn").attr("data-id",d),$("#replyCommentBtn").attr("data-type",v);if(v==2){var m=new r;m.url="/replies/"+d,m.fetch(),$("#bgIcon").addClass("other-icon").removeClass("old-icon")}if(v==1){var m=new n;m.url="/asks/"+d,m.fetch(),$("#bgIcon").addClass("old-icon").removeClass("other-icon")}var g=new i;g.url="/comments?target_type=new",g.data.type=v,g.data.target_id=d;var y=new Backbone.Marionette.Region({el:"#replyDetailPersonView"}),b=new o({model:m});y.show(b);var w=new Backbone.Marionette.Region({el:"#userIfo"}),b=new u({collection:g});w.show(b);var E=new Backbone.Marionette.Region({el:"#count"}),b=new a({model:m});E.show(b);var S=new Backbone.Marionette.Region({el:"#action"}),b=new f({model:m});S.show(b),setTimeout(function(){$(".reply-comment").height()>550?$(".reply-more").removeClass("blo"):$(".reply-more").addClass("blo"),$(".reply-detail-ifo").css({overflow:"hidden"})},700);var x=$("#bigPic").width(),T=$("#bigPic").height(),N=x/T,C=$("#bigPic").parents(".center-image"),k=$(C)[0].offsetWidth,L=$(C)[0].offsetHeight,A=0,O=0,M=0,_=0;T>=L&&x>=k?x/T>=k/L?(A=k,O=T*k/x,_=(L-O)/2,M=0):x/T<k/L&&(O=L,A=x*L/T,_=0,M=(k-A)/2):x<k&&T<L?N>k/L?(A=k,O=A/x*T,M=0,_=(L-O)/2):(A=x/T*L,O=L,_=0,M=(k-A)/2):x<=k&&T>=L?(O=L,A=N*L,M=(k-A)/2,_=0):x>=k&&T<=L&&(A=k,O=A/x*T,_=(L-O)/2,M=0),$("#bigPic").css("left",M),$("#bigPic").css("top",_),$("#bigPic").width(A),$("#bigPic").height(O),setTimeout(function(){$(".comment-content .border-bottom").removeClass("border-bot"),$(".border-bottom").eq($(".comment-content").find(".border-bottom").length-1).addClass("border-bot")},200)},construct:function(){var e=this;this.listenTo(this.model,"change",this.render)}})});